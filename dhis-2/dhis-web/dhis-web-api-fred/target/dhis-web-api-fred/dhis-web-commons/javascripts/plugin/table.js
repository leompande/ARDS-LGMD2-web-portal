Ext.onReady(function(){Ext.Ajax.method="GET";PT={};PT.instances=[];PT.i18n={};PT.isDebug=false;PT.isSessionStorage=("sessionStorage" in window&&window.sessionStorage!==null);PT.getCore=function(m){var i={},k={},j={},g={},h={},l;(function(){i.finals={url:{path_module:"/dhis-web-pivot/",organisationunitchildren_get:"getOrganisationUnitChildren.action"},dimension:{data:{value:"data",name:PT.i18n.data,dimensionName:"dx",objectName:"dx",warning:{filter:"..."}},category:{name:PT.i18n.categories,dimensionName:"co",objectName:"co"},indicator:{value:"indicators",name:PT.i18n.indicators,dimensionName:"dx",objectName:"in"},dataElement:{value:"dataElements",name:PT.i18n.data_elements,dimensionName:"dx",objectName:"de"},operand:{value:"operand",name:"Operand",dimensionName:"dx",objectName:"dc"},dataSet:{value:"dataSets",name:PT.i18n.data_sets,dimensionName:"dx",objectName:"ds"},period:{value:"period",name:PT.i18n.periods,dimensionName:"pe",objectName:"pe"},fixedPeriod:{value:"periods"},relativePeriod:{value:"relativePeriods"},organisationUnit:{value:"organisationUnits",name:PT.i18n.organisation_units,dimensionName:"ou",objectName:"ou"},dimension:{value:"dimension"},value:{value:"value"}},root:{id:"root"}};l=i.finals.dimension;l.objectNameMap={};l.objectNameMap[l.data.objectName]=l.data;l.objectNameMap[l.indicator.objectName]=l.indicator;l.objectNameMap[l.dataElement.objectName]=l.dataElement;l.objectNameMap[l.operand.objectName]=l.operand;l.objectNameMap[l.dataSet.objectName]=l.dataSet;l.objectNameMap[l.category.objectName]=l.category;l.objectNameMap[l.period.objectName]=l.period;l.objectNameMap[l.organisationUnit.objectName]=l.organisationUnit;l.objectNameMap[l.dimension.objectName]=l.dimension;i.period={periodTypes:[{id:"Daily",name:PT.i18n.daily},{id:"Weekly",name:PT.i18n.weekly},{id:"Monthly",name:PT.i18n.monthly},{id:"BiMonthly",name:PT.i18n.bimonthly},{id:"Quarterly",name:PT.i18n.quarterly},{id:"SixMonthly",name:PT.i18n.sixmonthly},{id:"Yearly",name:PT.i18n.yearly},{id:"FinancialOct",name:PT.i18n.financial_oct},{id:"FinancialJuly",name:PT.i18n.financial_july},{id:"FinancialApril",name:PT.i18n.financial_april}]};i.layout={west_width:424,west_fieldset_width:416,west_width_padding:4,west_fill:2,west_fill_accordion_indicator:59,west_fill_accordion_dataelement:59,west_fill_accordion_dataset:33,west_fill_accordion_period:296,west_fill_accordion_organisationunit:62,west_maxheight_accordion_indicator:400,west_maxheight_accordion_dataelement:400,west_maxheight_accordion_dataset:400,west_maxheight_accordion_period:513,west_maxheight_accordion_organisationunit:900,west_maxheight_accordion_group:340,west_maxheight_accordion_options:449,west_scrollbarheight_accordion_indicator:300,west_scrollbarheight_accordion_dataelement:300,west_scrollbarheight_accordion_dataset:300,west_scrollbarheight_accordion_period:450,west_scrollbarheight_accordion_organisationunit:450,west_scrollbarheight_accordion_group:300,east_tbar_height:31,east_gridcolumn_height:30,form_label_width:55,window_favorite_ypos:100,window_confirm_width:250,window_share_width:500,grid_favorite_width:420,grid_row_height:27,treepanel_minheight:135,treepanel_maxheight:400,treepanel_fill_default:310,treepanel_toolbar_menu_width_group:140,treepanel_toolbar_menu_width_level:120,multiselect_minheight:100,multiselect_maxheight:250,multiselect_fill_default:345,multiselect_fill_reportingrates:315};i.pivot={digitGroupSeparator:{comma:",",space:" "},displayDensity:{compact:"3px",normal:"5px",comfortable:"10px"},fontSize:{small:"10px",normal:"11px",large:"13px"}}}());(function(){k.layout={};k.layout.Record=function(n){var n=Ext.clone(n);return function(){if(!Ext.isObject(n)){console.log("Record: config is not an object: "+n);return}if(!Ext.isString(n.id)){alert("Record: id is not text: "+n);return}n.id=n.id.replace(".","-");return n}()};k.layout.Dimension=function(n){var n=Ext.clone(n);return function(){if(!Ext.isObject(n)){console.log("Dimension: config is not an object: "+n);return}if(!Ext.isString(n.dimension)){console.log("Dimension: name is not a string: "+n);return}if(n.dimension!==i.finals.dimension.category.objectName){var o=[];if(!Ext.isArray(n.items)){console.log("Dimension: items is not an array: "+n);return}for(var p=0;p<n.items.length;p++){o.push(k.layout.Record(n.items[p]))}n.items=Ext.Array.clean(o);if(!n.items.length){console.log("Dimension: has no valid items: "+n);return}}return n}()};k.layout.Layout=function(o){var o=Ext.clone(o),p={},n,q;n=function(s){var s=Ext.clone(s);if(!(s&&Ext.isArray(s)&&s.length)){return}for(var r=0;r<s.length;r++){s[r]=k.layout.Dimension(s[r])}s=Ext.Array.clean(s);return s.length?s:null};q=function(){var t=i.finals.dimension,s,u={};if(!p){return}s=Ext.Array.clean([].concat(p.columns||[],p.rows||[],p.filters||[]));for(var r=0;r<s.length;r++){u[s[r].dimension]=s[r]}if(p.filters&&p.filters.length){for(var r=0;r<p.filters.length;r++){if(p.filters[r].dimension===t.indicator.objectName){h.message.alert(PT.i18n.indicators_cannot_be_specified_as_filter||"Indicators cannot be specified as filter");return}if(p.filters[r].dimension===t.category.objectName){h.message.alert(PT.i18n.categories_cannot_be_specified_as_filter||"Categories cannot be specified as filter");return}if(p.filters[r].dimension===t.dataSet.objectName){h.message.alert(PT.i18n.data_sets_cannot_be_specified_as_filter||"Data sets cannot be specified as filter");return}}}if(u[t.operand.objectName]&&u[t.indicator.objectName]){h.message.alert("Indicators and detailed data elements cannot be specified together");return}if(u[t.operand.objectName]&&u[t.dataElement.objectName]){h.message.alert("Detailed data elements and totals cannot be specified together");return}if(u[t.operand.objectName]&&u[t.dataSet.objectName]){h.message.alert("Data sets and detailed data elements cannot be specified together");return}if(u[t.operand.objectName]&&u[t.category.objectName]){h.message.alert("Categories and detailed data elements cannot be specified together");return}return true};return function(){var r=[],t=i.finals.dimension;if(!(o&&Ext.isObject(o))){alert("Layout: config is not an object ("+m.el+")");return}o.columns=n(o.columns);o.rows=n(o.rows);o.filters=n(o.filters);if(!(o.columns||o.rows)){alert(PT.i18n.at_least_one_dimension_must_be_specified_as_row_or_column);return}for(var s=0,u=Ext.Array.clean([].concat(o.columns||[],o.rows||[],o.filters||[]));s<u.length;s++){if(k.layout.Dimension(u[s])){r.push(u[s].dimension)}}if(!Ext.Array.contains(r,t.period.objectName)){alert(PT.i18n.at_least_one_period_must_be_specified_as_column_row_or_filter);return}if(o.id){p.id=o.id}if(o.name){p.name=o.name}p.columns=o.columns;p.rows=o.rows;p.filters=o.filters;p.showTotals=Ext.isBoolean(o.totals)?o.totals:(Ext.isBoolean(o.showTotals)?o.showTotals:true);p.showSubTotals=Ext.isBoolean(o.subtotals)?o.subtotals:(Ext.isBoolean(o.showSubTotals)?o.showSubTotals:true);p.hideEmptyRows=Ext.isBoolean(o.hideEmptyRows)?o.hideEmptyRows:false;p.showHierarchy=Ext.isBoolean(o.showHierarchy)?o.showHierarchy:false;p.displayDensity=Ext.isString(o.displayDensity)&&!Ext.isEmpty(o.displayDensity)?o.displayDensity:"normal";p.fontSize=Ext.isString(o.fontSize)&&!Ext.isEmpty(o.fontSize)?o.fontSize:"normal";p.digitGroupSeparator=Ext.isString(o.digitGroupSeparator)&&!Ext.isEmpty(o.digitGroupSeparator)?o.digitGroupSeparator:"space";p.legendSet=Ext.isObject(o.legendSet)&&Ext.isString(o.legendSet.id)?o.legendSet:null;p.parentGraphMap=Ext.isObject(o.parentGraphMap)?o.parentGraphMap:null;p.sorting=Ext.isObject(o.sorting)&&Ext.isString(o.sorting.id)&&Ext.isString(o.sorting.direction)?o.sorting:null;p.reportingPeriod=Ext.isObject(o.reportParams)&&Ext.isBoolean(o.reportParams.paramReportingPeriod)?o.reportParams.paramReportingPeriod:(Ext.isBoolean(o.reportingPeriod)?o.reportingPeriod:false);p.organisationUnit=Ext.isObject(o.reportParams)&&Ext.isBoolean(o.reportParams.paramOrganisationUnit)?o.reportParams.paramOrganisationUnit:(Ext.isBoolean(o.organisationUnit)?o.organisationUnit:false);p.parentOrganisationUnit=Ext.isObject(o.reportParams)&&Ext.isBoolean(o.reportParams.paramParentOrganisationUnit)?o.reportParams.paramParentOrganisationUnit:(Ext.isBoolean(o.parentOrganisationUnit)?o.parentOrganisationUnit:false);p.regression=Ext.isBoolean(o.regression)?o.regression:false;p.cumulative=Ext.isBoolean(o.cumulative)?o.cumulative:false;p.sortOrder=Ext.isNumber(o.sortOrder)?o.sortOrder:0;p.topLimit=Ext.isNumber(o.topLimit)?o.topLimit:0;if(!q()){return}return p}()};k.response={};k.response.Header=function(n){var n=Ext.clone(n);return function(){if(!Ext.isObject(n)){console.log("Header: config is not an object: "+n);return}if(!Ext.isString(n.name)){console.log("Header: name is not a string: "+n);return}if(!Ext.isBoolean(n.meta)){console.log("Header: meta is not boolean: "+n);return}return n}()};k.response.Response=function(n){var n=Ext.clone(n);return function(){if(!(n&&Ext.isObject(n))){console.log("Response: config is not an object");return}if(!(n.headers&&Ext.isArray(n.headers))){console.log("Response: headers is not an array");return}for(var o=0,p;o<n.headers.length;o++){n.headers[o]=k.response.Header(n.headers[o])}n.headers=Ext.Array.clean(n.headers);if(!n.headers.length){console.log("Response: no valid headers");return}if(!(Ext.isArray(n.rows)&&n.rows.length>0)){alert("No values found");return}if(n.headers.length!==n.rows[0].length){console.log("Response: headers.length !== rows[0].length")}return n}()}}());(function(){j.prototype={};j.prototype.array={};j.prototype.array.getLength=function(o,n){if(!Ext.isArray(o)){if(!n){console.log("support.prototype.array.getLength: not an array")}return null}return o.length};j.prototype.array.sort=function(p,o,n){if(!j.prototype.array.getLength(p)){return}n=n||"name";p.sort(function(r,q){if(Ext.isObject(r)&&Ext.isObject(q)&&n){r=r[n];q=q[n]}if(Ext.isString(r)&&Ext.isString(q)){r=r.toLowerCase();q=q.toLowerCase();if(o==="DESC"){return r<q?1:(r>q?-1:0)}else{return r<q?-1:(r>q?1:0)}}else{if(Ext.isNumber(r)&&Ext.isNumber(q)){return o==="DESC"?q-r:r-q}}return -1});return p};j.prototype.object={};j.prototype.object.getLength=function(n,q){if(!Ext.isObject(n)){if(!q){console.log("support.prototype.object.getLength: not an object")}return null}var p=0;for(var o in n){if(n.hasOwnProperty(o)){p++}}return p};j.prototype.object.hasObject=function(o,r,q){if(!j.prototype.object.getLength(o)){return null}for(var p in o){var n=o[p];if(o.hasOwnProperty(p)&&n[r]===q){return true}}return null};j.prototype.str={};j.prototype.str.replaceAll=function(p,o,n){return p.replace(new RegExp(o,"g"),n)};j.prototype.str.toggleDirection=function(n){return n==="DESC"?"ASC":"DESC"};j.prototype.number={};j.prototype.number.getNumberOfDecimals=function(n){var o=new String(n);return(o.indexOf(".")>-1)?(o.length-o.indexOf(".")-1):0};j.prototype.number.roundIf=function(p,n){p=parseFloat(p);n=parseFloat(n);if(Ext.isNumber(p)&&Ext.isNumber(n)){var o=j.prototype.number.getNumberOfDecimals(p);return o>n?Ext.Number.toFixed(p,n):p}return p};j.prototype.number.prettyPrint=function(n,o){o=o||"space";if(o==="none"){return n}return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,i.pivot.digitGroupSeparator[o])};j.color={};j.color.hexToRgb=function(p){var o=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,n;p=p.replace(o,function(s,u,t,q){return u+u+t+t+q+q});n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(p);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null}}());(function(){g.layout={};g.layout.cleanDimensionArray=function(o){if(!j.prototype.array.getLength(o)){return null}var p=[];for(var n=0;n<o.length;n++){p.push(k.layout.Dimension(o[n]))}p=Ext.Array.clean(p);return p.length?p:null};g.layout.sortDimensionArray=function(q,p){if(!j.prototype.array.getLength(q,true)){return null}q=g.layout.cleanDimensionArray(q);if(!q){console.log("service.layout.sortDimensionArray: no valid dimensions");return null}p=p||"dimensionName";Ext.Array.sort(q,function(s,r){if(s[p]<r[p]){return -1}if(s[p]>r[p]){return 1}return 0});for(var o=0,n;o<q.length;o++){j.prototype.array.sort(q[o].items,"ASC","id");if(j.prototype.array.getLength(q[o].ids)){j.prototype.array.sort(q[o].ids)}}return q};g.layout.getObjectNameDimensionMapFromDimensionArray=function(q){var p={};if(!j.prototype.array.getLength(q)){return null}for(var n=0,o;n<q.length;n++){o=k.layout.Dimension(q[n]);if(o){p[o.dimension]=o}}return j.prototype.object.getLength(p)?p:null};g.layout.getObjectNameDimensionItemsMapFromDimensionArray=function(q){var p={};if(!j.prototype.array.getLength(q)){return null}for(var n=0,o;n<q.length;n++){o=k.layout.Dimension(q[n]);if(o){p[o.dimension]=o.items}}return j.prototype.object.getLength(p)?p:null};g.layout.getItemName=function(t,p,u,s){var o=p.metaData,q="";if(g.layout.isHierarchy(t,p,u)){var n=Ext.Array.clean(o.ouHierarchy[u].split("/"));n.shift();for(var r=0;r<n.length;r++){q+=(s?'<span class="text-weak">':"")+o.names[n[r]]+(s?"</span>":"")+" / "}}q+=o.names[u];return q};g.layout.getExtendedLayout=function(s){var s=Ext.clone(s),u;u={columns:[],rows:[],filters:[],columnObjectNames:[],columnDimensionNames:[],rowObjectNames:[],rowDimensionNames:[],axisDimensions:[],axisObjectNames:[],axisDimensionNames:[],sortedAxisDimensionNames:[],filterDimensions:[],filterObjectNames:[],filterDimensionNames:[],sortedFilterDimensions:[],dimensions:[],objectNames:[],dimensionNames:[],objectNameDimensionsMap:{},objectNameItemsMap:{},objectNameIdsMap:{},dimensionNameDimensionsMap:{},dimensionNameItemsMap:{},dimensionNameIdsMap:{},dimensionNameSortedIdsMap:{},sortableIdObjects:[]};Ext.applyIf(u,s);if(s.columns){for(var q=0,r,t,n;q<s.columns.length;q++){r=s.columns[q];t=r.items;n={};n.dimension=r.dimension;n.objectName=r.dimension;n.dimensionName=l.objectNameMap[r.dimension].dimensionName;if(t){n.items=t;n.ids=[];for(var p=0;p<t.length;p++){n.ids.push(t[p].id)}}u.columns.push(n);u.columnObjectNames.push(n.objectName);u.columnDimensionNames.push(n.dimensionName);u.axisDimensions.push(n);u.axisObjectNames.push(n.objectName);u.axisDimensionNames.push(l.objectNameMap[n.objectName].dimensionName);u.objectNameDimensionsMap[n.objectName]=n;u.objectNameItemsMap[n.objectName]=n.items;u.objectNameIdsMap[n.objectName]=n.ids}}if(s.rows){for(var q=0,r,t,n;q<s.rows.length;q++){r=Ext.clone(s.rows[q]);t=r.items;n={};n.dimension=r.dimension;n.objectName=r.dimension;n.dimensionName=l.objectNameMap[r.dimension].dimensionName;if(t){n.items=t;n.ids=[];for(var p=0;p<t.length;p++){n.ids.push(t[p].id)}}u.rows.push(n);u.rowObjectNames.push(n.objectName);u.rowDimensionNames.push(n.dimensionName);u.axisDimensions.push(n);u.axisObjectNames.push(n.objectName);u.axisDimensionNames.push(l.objectNameMap[n.objectName].dimensionName);u.objectNameDimensionsMap[n.objectName]=n;u.objectNameItemsMap[n.objectName]=n.items;u.objectNameIdsMap[n.objectName]=n.ids}}if(s.filters){for(var q=0,r,t,n;q<s.filters.length;q++){r=s.filters[q];t=r.items;n={};n.dimension=r.dimension;n.objectName=r.dimension;n.dimensionName=l.objectNameMap[r.dimension].dimensionName;if(t){n.items=t;n.ids=[];for(var p=0;p<t.length;p++){n.ids.push(t[p].id)}}u.filters.push(n);u.filterDimensions.push(n);u.filterObjectNames.push(n.objectName);u.filterDimensionNames.push(l.objectNameMap[n.objectName].dimensionName);u.objectNameDimensionsMap[n.objectName]=n;u.objectNameItemsMap[n.objectName]=n.items;u.objectNameIdsMap[n.objectName]=n.ids}}u.legendSet=s.legendSet?m.idLegendSetMap[s.legendSet.id]:null;if(s.legendSet){u.legendSet=m.idLegendSetMap[s.legendSet.id];j.prototype.array.sort(u.legendSet.mapLegends,"ASC","startValue")}u.axisDimensionNames=Ext.Array.unique(u.axisDimensionNames);u.filterDimensionNames=Ext.Array.unique(u.filterDimensionNames);u.columnDimensionNames=Ext.Array.unique(u.columnDimensionNames);u.rowDimensionNames=Ext.Array.unique(u.rowDimensionNames);u.filterDimensionNames=Ext.Array.unique(u.filterDimensionNames);u.sortedAxisDimensionNames=Ext.clone(u.axisDimensionNames).sort();u.sortedFilterDimensions=g.layout.sortDimensionArray(Ext.clone(u.filterDimensions));u.dimensions=[].concat(u.axisDimensions,u.filterDimensions);u.objectNames=[].concat(u.axisObjectNames,u.filterObjectNames);u.dimensionNames=[].concat(u.axisDimensionNames,u.filterDimensionNames);for(var q=0,o;q<u.dimensionNames.length;q++){o=u.dimensionNames[q];u.dimensionNameDimensionsMap[o]=[];u.dimensionNameItemsMap[o]=[];u.dimensionNameIdsMap[o]=[]}for(var q=0,n;q<u.dimensions.length;q++){n=u.dimensions[q];u.dimensionNameDimensionsMap[n.dimensionName].push(n);u.dimensionNameItemsMap[n.dimensionName]=u.dimensionNameItemsMap[n.dimensionName].concat(n.items);u.dimensionNameIdsMap[n.dimensionName]=u.dimensionNameIdsMap[n.dimensionName].concat(n.ids)}for(var v in u.dimensionNameIdsMap){if(u.dimensionNameIdsMap.hasOwnProperty(v)){u.dimensionNameSortedIdsMap[v]=Ext.clone(u.dimensionNameIdsMap[v]).sort()}}u.tableUuid=m.el+"_"+Ext.data.IdGenerator.get("uuid").generate();return u};g.layout.getSyncronizedXLayout=function(o,n){var q,r,p=Ext.Array.clean([].concat(o.columns||[],o.rows||[],o.filters||[]));q=function(t){var s;s=function(v){var w;v=Ext.clone(v);for(var u=0;u<v.length;u++){if(v[u].dimension===t){w=v[u]}}if(w){Ext.Array.remove(v,w)}return v};if(o.columns){o.columns=s(o.columns)}if(o.rows){o.rows=s(o.rows)}if(o.filters){o.filters=s(o.filters)}};r=function(){var t=[];for(var s=0;s<n.headers.length;s++){t.push(n.headers[s].name)}return t};return function(){var t=r(),O=o.objectNameDimensionsMap[l.organisationUnit.objectName],z=O&&Ext.Array.contains(O.ids,"USER_ORGUNIT"),Q=O&&Ext.Array.contains(O.ids,"USER_ORGUNIT_CHILDREN"),N=O&&Ext.Array.contains(O.ids,"USER_ORGUNIT_GRANDCHILDREN"),s=function(){if(O&&Ext.isArray(O.ids)){for(var S=0;S<O.ids.length;S++){if(O.ids[S].substr(0,5)==="LEVEL"){return true}}}return false}(),B=function(){if(O&&Ext.isArray(O.ids)){for(var S=0;S<O.ids.length;S++){if(O.ids[S].substr(0,8)==="OU_GROUP"){return true}}}return false}(),y=l.category.objectName,v=l.organisationUnit.objectName,R;for(var J=0,H,A,C;J<p.length;J++){H=p[J];H.items=[];A=n.metaData[H.objectName];if(H.dimensionName===v){if(z||Q||N){var M,x,E;if(z){M=[{id:m.user.ou,name:g.layout.getItemName(o,n,m.user.ou,false)}]}if(Q){x=[];for(var G=0;G<m.user.ouc.length;G++){x.push({id:m.user.ouc[G],name:g.layout.getItemName(o,n,m.user.ouc[G],false)})}j.prototype.array.sort(x)}if(N){var u=[].concat(m.user.ou,m.user.ouc),w=n.metaData[v];E=[];for(var G=0,D;G<w.length;G++){D=w[G];if(!Ext.Array.contains(u,D)){E.push({id:D,name:g.layout.getItemName(o,n,D,false)})}}j.prototype.array.sort(E)}H.items=[].concat(M||[],x||[],E||[])}else{if(s||B){for(var G=0,w=n.metaData[v],D;G<w.length;G++){D=w[G];H.items.push({id:D,name:g.layout.getItemName(o,n,D,false)})}j.prototype.array.sort(H.items)}else{H.items=Ext.clone(o.dimensionNameItemsMap[H.dimensionName])}}}else{if(Ext.isArray(A)&&A.length){var F=Ext.clone(n.metaData[H.dimensionName]);for(var G=0;G<F.length;G++){H.items.push({id:F[G],name:n.metaData.names[F[G]]})}}else{H.items=Ext.clone(o.objectNameItemsMap[H.objectName])}}}for(var J=0,K;J<o.axisDimensionNames.length;J++){K=o.axisDimensionNames[J];if(!Ext.Array.contains(t,K)){q(K)}}R=k.layout.Layout(o);if(R){p=Ext.Array.clean([].concat(R.columns||[],R.rows||[],R.filters||[]));for(var J=0,I=n.metaData.names,L;J<p.length;J++){L=p[J].items;if(Ext.isArray(L)&&L.length){for(var G=0,P;G<L.length;G++){P=L[G];if(Ext.isObject(P)&&Ext.isString(I[P.id])&&!Ext.isString(P.name)){P.name=I[P.id]||""}}}}return g.layout.getExtendedLayout(R)}return null}()};g.layout.getExtendedAxis=function(z,L,Z){var t,r,A=[],y=1,I,q,E=[],Y=[],s=[],D=[],w=[],x=[],N=[],u={};if(Z==="col"){t=Ext.clone(z.columnDimensionNames);r="colSpan"}else{if(Z==="row"){t=Ext.clone(z.rowDimensionNames);r="rowSpan"}}if(!(Ext.isArray(t)&&t.length)){return}for(var U=0;U<t.length;U++){A.push({dimensionName:t[U]})}q=function(){var n=[];for(var aa=0;aa<A.length;aa++){n.push(L.nameHeaderMap[A[aa].dimensionName].ids)}return n}();I=q.length;for(var U=0,K;U<I;U++){K=q[U].length;E.push(K);y=y*K;Y.push(y)}for(var U=0;U<I;U++){if(E[U]===1){if(U===0){s.push(y)}else{if(z.hideEmptyRows&&Z==="row"){s.push(y/Y[U])}else{s.push(s[0])}}}else{s.push(y/Y[U])}}D.push(q[0]);if(I.length>1){for(var U=1,W,O;U<I;U++){W=[];O=E[U]===1?E[0]:Y[U-1];for(var S=0;S<O;S++){W=W.concat(q[U])}D.push(W)}}for(var U=0,v,P,B,T;U<I;U++){v=[];P=q[U];B=s[U];T=y/(B*P.length);for(var S=0;S<T;S++){for(var R=0;R<P.length;R++){for(var Q=0;Q<B;Q++){v.push(P[R])}}}w.push(v)}for(var U=0,H;U<y;U++){H="";for(var S=0;S<I;S++){H+=w[S][U]}if(H){x.push(H)}}for(var U=0,F;U<w.length;U++){F=[];for(var S=0,p;S<w[U].length;S++){p={id:w[U][S],uuid:Ext.data.IdGenerator.get("uuid").generate(),dim:U,axis:Z};if(U===w.length-1){p.leaf=true}F.push(p)}N.push(F)}for(var U=0;U<N.length;U++){for(var S=0,p,X=0,o;S<N[U].length;S++){p=N[U][S];if(X===0){p[r]=s[U];p.children=p.leaf?0:s[U];p.oldest=true;if(U===0){p.root=true}o=p}p.oldestSibling=o;if(++X===s[U]){X=0}}}if(I>1){for(var U=1,F;U<I;U++){F=N[U];for(var S=0,X=0,B=s[U-1];S<F.length;S++){F[S].parent=N[U-1][S]}}}if(N.length){var B=I>1?j.prototype.array.sort(Ext.clone(s))[1]:y,J=N[N.length-1];for(var U=0,V,C,p,G=[];U<J.length;U++){V=J[U];G.push(V.uuid);C=[];p=V;while(p.parent){p=p.parent;C.push(p.oldestSibling.uuid)}V.uuids=Ext.clone(C);if(G.length===B){for(var S=(U-B)+1,V;S<=U;S++){V=J[S];V.uuids=V.uuids.concat(Ext.clone(G))}G=[]}}}for(var U=0;U<N.length;U++){for(var S=0,M;S<N[U].length;S++){M=N[U][S];u[M.uuid]=M}}return{type:Z,items:A,xItems:{unique:q,gui:D,all:w},objects:{all:N},ids:x,span:s,dims:I,size:y,uuidObjectMap:u}};g.layout.isHierarchy=function(o,n,p){return o.showHierarchy&&Ext.isObject(n.metaData.ouHierarchy)&&n.metaData.ouHierarchy.hasOwnProperty(p)};g.layout.layout2plugin=function(r){var r=Ext.clone(r),q=Ext.Array.clean([].concat(r.columns||[],r.rows||[],r.filters||[]));if(Ext.isString(r.id)){return{id:r.id}}for(var o=0,s,p;o<q.length;o++){s=q[o];delete s.id;delete s.ids;delete s.type;delete s.dimensionName;delete s.objectName;for(var n=0,p;n<s.items.length;n++){p=s.items[n];delete p.name;delete p.code;delete p.created;delete p.lastUpdated}}if(r.showTotals){delete r.showTotals}if(r.showSubTotals){delete r.showSubTotals}if(!r.hideEmptyRows){delete r.hideEmptyRows}if(!r.showHierarchy){delete r.showHierarchy}if(r.displayDensity==="normal"){delete r.displayDensity}if(r.fontSize==="normal"){delete r.fontSize}if(r.digitGroupSeparator==="space"){delete r.digitGroupSeparator}if(!r.legendSet){delete r.legendSet}if(!r.sorting){delete r.sorting}delete r.parentGraphMap;delete r.reportingPeriod;delete r.organisationUnit;delete r.parentOrganisationUnit;delete r.regression;delete r.cumulative;delete r.sortOrder;delete r.topLimit;return r};g.response={};g.response.getExtendedResponse=function(o,n){var p=[];n.nameHeaderMap={};n.idValueMap={};(function(){for(var q=0,r;q<n.headers.length;q++){r=n.headers[q];r.index=q;if(r.meta){r.ids=Ext.clone(o.dimensionNameIdsMap[r.name])||[];r.size=r.ids.length;p=p.concat(r.ids)}}for(var q=0,r;q<n.headers.length;q++){r=n.headers[q];n.nameHeaderMap[r.name]=r}}());(function(){for(var q=0,s,r;q<p.length;q++){s=p[q];if(s.indexOf("-")!==-1){r=s.split("-");n.metaData.names[s]=n.metaData.names[r[0]]+" "+n.metaData.names[r[1]]}}}());(function(){var v=n.nameHeaderMap[i.finals.dimension.value.value].index,r=n.nameHeaderMap[i.finals.dimension.category.dimensionName],z=l.data.dimensionName,w=l.category.dimensionName,t=o.axisDimensionNames,x=[];for(var u=0;u<t.length;u++){x.push(n.nameHeaderMap[t[u]].index);if(r&&!Ext.Array.contains(t,w)&&t[u]===z){x.push(r.index)}}for(var u=0,y,q;u<n.rows.length;u++){y=n.rows[u];q="";for(var s=0;s<x.length;s++){q+=y[x[s]]}n.idValueMap[q]=y[v]}}());return n}}());(function(){h.mask={};h.mask.show=function(n,o){if(!Ext.isObject(n)){console.log("support.gui.mask.show: component not an object");return null}o=o||"Loading..";if(Ext.isObject(n.mask)&&n.mask.destroy){n.mask.destroy();n.mask=null}n.mask=new Ext.create("Ext.LoadMask",n,{shadow:false,message:o,style:"box-shadow:0",bodyStyle:"box-shadow:0"});n.mask.show()};h.mask.hide=function(n){if(!Ext.isObject(n)){console.log("support.gui.mask.hide: component not an object");return null}if(n.mask){n.mask.destroy();n.mask=null}};h.message={};h.message.alert=function(n){console.log(n)};h.analytics={};h.analytics.getParamString=function(A,q){var u=q?A.sortedAxisDimensionNames:A.axisDimensionNames,B=q?A.sortedFilterDimensions:A.filterDimensions,n=q?A.dimensionNameSortedIdsMap:A.dimensionNameIdsMap,r="?",p=false,o=A.dimensionNameItemsMap,C=l.indicator.dimensionName,z=l.category.dimensionName;for(var v=0,s,y;v<u.length;v++){s=u[v];r+="dimension="+s;y=Ext.clone(n[s]);if(s===C){for(var t=0,x;t<y.length;t++){x=y[t].indexOf("-");if(x>0){p=true;y[t]=y[t].substr(0,x)}}y=Ext.Array.unique(y)}if(s!==z){r+=":"+y.join(";")}if(v<(u.length-1)){r+="&"}}if(p){r+="&dimension="+i.finals.dimension.category.dimensionName}if(Ext.isArray(B)&&B.length){for(var v=0,w;v<B.length;v++){w=B[v];r+="&filter="+w.dimensionName+":"+w.ids.join(";")}}if(A.showHierarchy){r+="&hierarchyMeta=true"}return r};h.analytics.validateUrl=function(o){var p;if(Ext.isIE){p="Too many items selected (url has "+o.length+" characters). Internet Explorer accepts maximum 2048 characters."}else{var n=o.length>8000?"8000":(o.length>4000?"4000":"2000");p="Too many items selected (url has "+o.length+" characters). Please reduce to less than "+n+" characters."}p+="\n\nHint: A good way to reduce the number of items is to use relative periods and level/group organisation unit selection modes.";alert(p)};h.pivot={};h.pivot.getHtml=function(C,p,I,B){var v,D,n,o,F,s,q,u,z,E,K,t=function(L){if(!L){return null}var M=L.xItems.unique;if(M){return M.length<2?1:(L.size/M[0].length)}return null},H=t(I),A=t(B),y=[],J=[],r=[],x={},w=Ext.isObject(C.legendSet)&&Ext.isArray(C.legendSet.mapLegends)&&C.legendSet.mapLegends.length,G;v=function(L,M){M=M||2;return parseFloat(j.prototype.number.roundIf(L,2)).toString()};D=function(O,X){var U,V,R,S,M,N,Z,L=Ext.isObject(O)&&Ext.isString(O.type)&&O.type.substr(0,5)==="value"&&!O.empty,T=Ext.isObject(O)&&Ext.isString(O.type)&&O.type==="value"&&!O.empty,Y="",Q="";if(!Ext.isObject(O)){return""}if(L&&C.legendSet){var W=parseFloat(O.value);V=C.legendSet.mapLegends;for(var P=0;P<V.length;P++){if(Ext.Number.constrain(W,V[P].startValue,V[P].endValue)===W){U=V[P].color}}}R=O.colSpan?'colspan="'+O.colSpan+'" ':"";S=O.rowSpan?'rowspan="'+O.rowSpan+'" ':"";M=O.collapsed?"":O.htmlValue||O.value||"";M=O.type!=="dimension"?j.prototype.number.prettyPrint(M,C.digitGroupSeparator):M;N=i.pivot.displayDensity[O.displayDensity]||i.pivot.displayDensity[C.displayDensity];Z=i.pivot.fontSize[O.fontSize]||i.pivot.fontSize[C.fontSize];Y+=O.hidden?" td-hidden":"";Y+=O.collapsed?" td-collapsed":"";Y+=T?" pointer":"";Y+=U?" legend":(O.cls?" "+O.cls:"");if(Ext.isString(X)){Y+=" td-sortable";C.sortableIdObjects.push({id:X,uuid:O.uuid})}Q+="<td "+(O.uuid?('id="'+O.uuid+'" '):"");Q+=' class="'+Y+'" '+R+S;if(U){Q+=">";Q+='<div class="legendCt">';Q+='<div class="number '+O.cls+'" style="padding:'+N+"; padding-right:3px; font-size:"+Z+'">'+M+"</div>";Q+='<div class="arrowCt '+O.cls+'">';Q+='<div class="arrow" style="border-bottom:8px solid transparent; border-right:8px solid '+U+'">&nbsp;</div>';Q+="</div></div></div></td>"}else{Q+='style="padding:'+N+"; font-size:"+Z+';">'+M+"</td>"}return Q};n=function(L){return !!C.showSubTotals&&L&&L.dims>1};o=function(){return !!C.showTotals};doSortableColumnHeaders=function(){return(B&&B.dims===1)};F=function(){var T=[],L;L=function(){return(I&&B)?D({cls:"pivot-dim-empty cursor-default",colSpan:B.dims,rowSpan:I.dims,htmlValue:"&nbsp;"}):""};if(!(I&&Ext.isObject(I))){return T}for(var Q=0,S;Q<I.dims;Q++){S=[];if(Q===0){S.push(L())}for(var O=0,P,M=0,R,N;O<I.size;O++){M++;P=I.objects.all[Q][O];P.type="dimension";P.cls="pivot-dim";P.noBreak=false;P.hidden=!(P.rowSpan||P.colSpan);P.htmlValue=g.layout.getItemName(C,p,P.id,true);if(Q===I.dims-1&&doSortableColumnHeaders()){R=I.ids[O].split("-").join("")}S.push(D(P,R));if(Q===0&&M===I.span[Q]&&n(I)){S.push(D({type:"dimensionSubtotal",cls:"pivot-dim-subtotal cursor-default",rowSpan:I.dims,htmlValue:"&nbsp;"}));M=0}if(Q===0&&(O===I.size-1)&&o()){N=doSortableColumnHeaders()?"total_":null;S.push(D({uuid:Ext.data.IdGenerator.get("uuid").generate(),type:"dimensionTotal",cls:"pivot-dim-total",rowSpan:I.dims,htmlValue:"Total"},N))}}T.push(S)}return T};s=function(){var aA=[],X=[],al,R=[],af=[],ab,ad=I?I.size:1,an=B?B.size:1,ae;ae=function(aB){if(!aB.children){aB.collapsed=true;if(aB.parent){aB.parent.oldestSibling.children--}}if(aB.parent){ae(aB.parent.oldestSibling)}};if(B){for(var aw=0,Z;aw<B.size;aw++){Z=[];for(var av=0,P,ap;av<B.dims;av++){P=B.objects.all[av][aw];P.type="dimension";P.cls="pivot-dim td-nobreak"+(g.layout.isHierarchy(C,p,P.id)?" align-left":"");P.noBreak=true;P.hidden=!(P.rowSpan||P.colSpan);P.htmlValue=g.layout.getItemName(C,p,P.id,true);Z.push(P)}X.push(Z)}}for(var aw=0,N,Q,at=Ext.clone(p.idValueMap);aw<an;aw++){N=[];Q=[];for(var av=0,aj,aq,ay,L,S,M;av<ad;av++){L=false;M=[];aj=(I?j.prototype.str.replaceAll(I.ids[av],"-",""):"")+(B?j.prototype.str.replaceAll(B.ids[aw],"-",""):"");S=Ext.data.IdGenerator.get("uuid").generate();if(I){M=M.concat(I.objects.all[I.dims-1][av].uuids)}if(B){M=M.concat(B.objects.all[B.dims-1][aw].uuids)}if(at[aj]){aq=parseFloat(at[aj]);ay=aq.toString()}else{aq=0;ay="&nbsp;";L=true}N.push(aq);Q.push({uuid:S,type:"value",cls:"pivot-value"+(L?" cursor-default":""),value:aq,htmlValue:ay,empty:L,uuids:M});x[S]=M}y.push(N);J.push(Q)}if(I&&o()){for(var aw=0,L=[],ai=0;aw<J.length;aw++){for(av=0,P;av<J[aw].length;av++){P=J[aw][av];L.push(P.empty);ai+=P.value}R.push({type:"valueTotal",cls:"pivot-value-total",value:ai,htmlValue:Ext.Array.contains(L,false)?v(ai):"",empty:!Ext.Array.contains(L,false)});if(doSortableColumnHeaders()){var W="total_"+B.ids[aw],aa=!Ext.Array.contains(L,false);p.idValueMap[W]=aa?null:ai}L=[];ai=0}}if(I&&B){if(C.hideEmptyRows){for(var aw=0,am,O,ac;aw<J.length;aw++){am=J[aw];O=!Ext.Array.contains(Ext.Array.pluck(am,"empty"),false);if(O){for(var av=0;av<am.length;av++){am[av].collapsed=true}if(o()){R[aw].collapsed=true}ac=X[aw][B.dims-1];ae(ac)}}}}al=Ext.clone(J);if(n(I)){var ag=[];for(var aw=0,Z,V,Y;aw<al.length;aw++){Z=[];V=0;Y=0;for(var av=0,ah,az=[],L=[];av<al[aw].length;av++){ah=al[aw][av];V+=ah.value;L.push(!!ah.empty);az.push(!!ah.collapsed);Y++;Z.push(ah);if(Y===H){var aa=!Ext.Array.contains(L,false);Z.push({type:"valueSubtotal",cls:"pivot-value-subtotal"+(aa?" cursor-default":""),value:V,htmlValue:aa?"&nbsp;":v(V),empty:aa,collapsed:!Ext.Array.contains(az,false)});Y=0;V=0;L=[];az=[]}}ag.push(Z)}al=ag}if(n(B)){var ak=[],ag=[],ax=[],au;au=function(aE){var aD=[];for(var aB=0,aC;aB<B.dims;aB++){aC={};aC.type="dimensionSubtotal";aC.cls="pivot-dim-subtotal cursor-default";aC.collapsed=Ext.Array.contains(aE,true);if(aB===0){aC.htmlValue="&nbsp;";aC.colSpan=B.dims}else{aC.hidden=true}aD.push(aC)}return aD};for(var aw=0,Z,az=[];aw<X.length;aw++){ak.push(X[aw]);az.push(!!X[aw][0].collapsed);if(!Ext.isArray(X[aw+1])||!!X[aw+1][0].root){ak.push(au(az));az=[]}}for(var aw=0;aw<ak.length;aw++){ag.push([])}for(var aw=0;aw<al[0].length;aw++){for(var av=0,T=0,ao=0,U=0,L=[],az,ah;av<al.length;av++){ah=al[av][aw];ag[ao++].push(ah);U+=ah.value;L.push(!!ah.empty);T++;if(X[av][0].root){az=!!X[av][0].collapsed}if(!Ext.isArray(X[av+1])||X[av+1][0].root){var aa=!Ext.Array.contains(L,false);ag[ao++].push({type:ah.type==="value"?"valueSubtotal":"valueSubtotalTotal",value:U,htmlValue:aa?"&nbsp;":v(U),collapsed:az,cls:(ah.type==="value"?"pivot-value-subtotal":"pivot-value-subtotal-total")+(aa?" cursor-default":"")});T=0;U=0;L=[]}}}for(var aw=0,P,az=[],L=[],U=0,ar=0;aw<R.length;aw++){P=R[aw];ax.push(P);az.push(!!P.collapsed);L.push(!!P.empty);U+=P.value;ar++;if(ar===B.span[0]){var aa=!Ext.Array.contains(L,false);ax.push({type:"valueTotalSubgrandtotal",cls:"pivot-value-total-subgrandtotal"+(aa?" cursor-default":""),value:U,htmlValue:aa?"&nbsp;":v(U),empty:aa,collapsed:!Ext.Array.contains(az,false)});az=[];L=[];U=0;ar=0}}X=ak;al=ag;R=ax}for(var aw=0,Z;aw<al.length;aw++){Z=[];if(B){Z=Z.concat(X[aw])}Z=Z.concat(al[aw]);if(I){Z=Z.concat(R[aw])}af.push(Z)}for(var aw=0,Z;aw<af.length;aw++){Z=[];for(var av=0;av<af[aw].length;av++){Z.push(D(af[aw][av]))}aA.push(Z)}return aA};u=function(){var S=[];if(B&&o()){var V;for(var N=0,R=0,Q=[];N<J[0].length;N++){for(var L=0,M;L<J.length;L++){M=J[L][N];R+=M.value;Q.push(!!M.empty)}r.push({type:"valueTotal",value:R,htmlValue:Ext.Array.contains(Q,false)?v(R):"",empty:!Ext.Array.contains(Q,false),cls:"pivot-value-total"});R=0;Q=[]}V=Ext.clone(r);if(I&&n(I)){var O=[];for(var N=0,U,P=0,Q=[],T=0;N<V.length;N++){U=V[N];O.push(U);P+=U.value;Q.push(!!U.empty);T++;if(T===H){O.push({type:"valueTotalSubgrandtotal",value:P,htmlValue:Ext.Array.contains(Q,false)?v(P):"",empty:!Ext.Array.contains(Q,false),cls:"pivot-value-total-subgrandtotal"});P=0;T=0}}V=O}for(var N=0;N<V.length;N++){S.push(D(V[N]))}}return S};z=function(){var N=0,O=[],L=[];if(o()){for(var M=0,P;M<r.length;M++){P=r[M];N+=P.value;O.push(P.empty)}if(I&&B){L.push(D({type:"valueGrandTotal",cls:"pivot-value-grandtotal",value:N,htmlValue:Ext.Array.contains(O,false)?v(N):"",empty:!Ext.Array.contains(O,false)}))}}return L};E=function(){var N,M=u(),O=z(),P,L=[];if(o()){if(B){N=[D({type:"dimensionSubtotal",cls:"pivot-dim-total",colSpan:B.dims,htmlValue:"Total"})]}P=[].concat(N||[],Ext.clone(M)||[],Ext.clone(O)||[]);L.push(P)}return L};K=function(){var M='<table id="'+C.tableUuid+'" class="pivot">';for(var L=0;L<G.length;L++){M+="<tr>"+G[L].join("")+"</tr>"}return M+="</table>"};return function(){G=Ext.Array.clean([].concat(F()||[],s()||[],E()||[]));return{html:K(G),uuidDimUuidsMap:x}}()}}());(function(){if(Ext.isArray(m.dimensions)){j.prototype.array.sort(m.dimensions);for(var n=0,o;n<m.dimensions.length;n++){o=m.dimensions[n];o.dimensionName=o.id;o.objectName=i.finals.dimension.dimension.objectName;i.finals.dimension.objectNameMap[o.id]=o}}j.prototype.array.sort(m.user.ouc);m.idLegendSetMap={};for(var n=0,p;n<m.legendSets.length;n++){p=m.legendSets[n];m.idLegendSetMap[p.id]=p}}());return{conf:i,api:k,support:j,service:g,web:h,init:m}};css="table.pivot { \n font-family: arial,sans-serif,ubuntu,consolas; \n } \n";css+=".td-nobreak { \n white-space: nowrap; \n } \n";css+=".td-hidden { \n display: none; \n } \n";css+=".td-collapsed { \n display: none; \n } \n";css+="table.pivot { \n border-collapse: collapse; \n border-spacing: 0px; \n border: 0 none; \n } \n";css+=".pivot td { \n padding: 5px; \n border: \n 1px solid #b2b2b2; \n } \n";css+=".pivot-dim { \n background-color: #dae6f8; \n text-align: center; \n } \n";css+=".pivot-dim.highlighted { \n	background-color: #c5d8f6; \n } \n";css+=".pivot-dim-subtotal { \n background-color: #cad6e8; \n text-align: center; \n } \n";css+=".pivot-dim-total { \n background-color: #bac6d8; \n text-align: center; \n } \n";css+=".pivot-dim-total.highlighted { \n background-color: #adb8c9; \n } \n";css+=".pivot-dim-empty { \n background-color: #dae6f8; \n text-align: center; \n } \n";css+=".pivot-value { \n background-color: #fff; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".pivot-value-subtotal { \n background-color: #f4f4f4; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".pivot-value-subtotal-total { \n background-color: #e7e7e7; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".pivot-value-total { \n background-color: #e4e4e4; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".pivot-value-total-subgrandtotal { \n background-color: #d8d8d8; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".pivot-value-grandtotal { \n background-color: #c8c8c8; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".x-mask-msg { \n padding: 0; \n	border: 0 none; \n background-image: none; \n background-color: transparent; \n } \n";css+=".x-mask-msg div { \n background-position: 11px center; \n } \n";css+=".x-mask-msg .x-mask-loading { \n border: 0 none; \n	background-color: #000; \n color: #fff; \n border-radius: 2px; \n padding: 12px 14px 12px 30px; \n opacity: 0.65; \n } \n";css+=".pivot td.legend { \n padding: 0; \n } \n";css+=".pivot div.legendCt { \n display: table; \n float: right; \n width: 100%; \n } \n";css+=".pivot div.arrowCt { \n display: table-cell; \n vertical-align: top; \n width: 8px; \n } \n";css+=".pivot div.arrow { \n width: 0; \n height: 0; \n } \n";css+=".pivot div.number { \n display: table-cell; \n } \n",css+=".pivot div.legendColor { \n display: table-cell; \n width: 2px; \n } \n";css+=".pointer { \n cursor: pointer; \n } \n";css+='.td-sortable { \n background-image: url("http://dhis2-cdn.org/v214/plugin/images/arrowupdown.png"); \n background-repeat: no-repeat; \n background-position: right center; \n padding-right: 15px !important; \n } \n';Ext.util.CSS.createStyleSheet(css);PT.plugin={};var e={user:{}},d=[],f=false,b=false,a,c;a=function(g){var m=false,l=[],k=0,j;j=function(){if(++k===l.length){b=true;for(var n=0;n<d.length;n++){c(d[n])}d=[]}};l.push({url:g+"/api/system/context.jsonp",success:function(i){e.contextPath=i.contextPath;j()}});l.push({url:g+"/api/organisationUnits.jsonp?userOnly=true&viewClass=detailed&links=false",success:function(n){var i=n.organisationUnits[0];e.user.ou=i.id;e.user.ouc=Ext.Array.pluck(i.children,"id");j()}});l.push({url:g+"/api/mapLegendSets.jsonp?viewClass=detailed&links=false&paging=false",success:function(i){e.legendSets=i.mapLegendSets;j()}});l.push({url:g+"/api/dimensions.jsonp?links=false&paging=false",success:function(i){e.dimensions=i.dimensions;j()}});for(var h=0;h<l.length;h++){Ext.data.JsonP.request(l[h])}};c=function(j){var l,i,h,g,k={core:{},app:{}};l=function(m){if(!Ext.isObject(m)){console.log("Report table configuration is not an object");return}if(!Ext.isString(m.el)){console.log("No valid element id provided");return}m.id=m.id||m.uid;return true};i=function(q){var r=k.core.init,p=k.core.api,o=k.core.support,m=k.core.service,n=k.core.web;n.events=n.events||{};n.events.setColumnHeaderMouseHandlers=function(t,s){if(Ext.isArray(t.sortableIdObjects)){for(var u=0,w,v;u<t.sortableIdObjects.length;u++){w=t.sortableIdObjects[u];v=Ext.get(w.uuid);v.dom.xLayout=t;v.dom.response=s;v.dom.metaDataId=w.id;v.dom.onColumnHeaderMouseClick=n.events.onColumnHeaderMouseClick;v.dom.onColumnHeaderMouseOver=n.events.onColumnHeaderMouseOver;v.dom.onColumnHeaderMouseOut=n.events.onColumnHeaderMouseOut;v.dom.setAttribute("onclick","this.onColumnHeaderMouseClick(this.xLayout, this.response, this.metaDataId)");v.dom.setAttribute("onmouseover","this.onColumnHeaderMouseOver(this)");v.dom.setAttribute("onmouseout","this.onColumnHeaderMouseOut(this)")}}};n.events.onColumnHeaderMouseClick=function(t,s,u){if(t.sorting&&t.sorting.id===u){t.sorting.direction=o.prototype.str.toggleDirection(t.sorting.direction)}else{t.sorting={id:u,direction:"DESC"}}k.core.web.pivot.sort(t,s,u)};n.events.onColumnHeaderMouseOver=function(s){Ext.get(s).addCls("pointer highlighted")};n.events.onColumnHeaderMouseOut=function(s){Ext.get(s).removeCls("pointer highlighted")};n.pivot=n.pivot||{};n.pivot.loadTable=function(s){if(!Ext.isString(s)){alert("Invalid report table id");return}Ext.data.JsonP.request({url:r.contextPath+"/api/reportTables/"+s+".jsonp?viewClass=dimensional&links=false",failure:function(t){window.open(r.contextPath+"/api/reportTables/"+s+".json?viewClass=dimensional&links=false","_blank")},success:function(u){var t=p.layout.Layout(u);if(t){n.pivot.getData(t,true)}}})};n.pivot.getData=function(t,u){var s,v;if(!t){return}s=m.layout.getExtendedLayout(t);v=n.analytics.getParamString(s,true);n.mask.show(k.app.centerRegion);Ext.data.JsonP.request({url:r.contextPath+"/api/analytics.jsonp"+v,timeout:60000,headers:{"Content-Type":"application/json",Accepts:"application/json"},disableCaching:false,failure:function(w){n.mask.hide(k.app.centerRegion);window.open(r.contextPath+"/api/analytics.json"+v,"_blank")},success:function(x){var w=p.response.Response(x);if(!w){n.mask.hide(k.app.centerRegion);return}s=m.layout.getSyncronizedXLayout(s,w);if(!s){n.mask.hide(k.app.centerRegion);return}k.app.paramString=v;n.pivot.createTable(t,s,w,u)}})};n.pivot.createTable=function(x,u,t,y){var z,w,s,v;if(!u){u=m.layout.getExtendedLayout(x)}z=m.response.getExtendedResponse(u,t);w=m.layout.getExtendedAxis(u,z,"col");s=m.layout.getExtendedAxis(u,z,"row");v=n.pivot.getHtml(u,z,w,s);k.app.centerRegion.update(v.html);k.app.layout=x;k.app.xLayout=u;k.app.response=t;k.app.xResponse=z;k.app.uuidDimUuidsMap=v.uuidDimUuidsMap;k.app.uuidObjectMap=Ext.applyIf((w?w.uuidObjectMap:{}),(s?s.uuidObjectMap:{}));n.events.setColumnHeaderMouseHandlers(u,t);n.mask.hide(k.app.centerRegion)};n.pivot.sort=function(y,u,s){var y=Ext.clone(y),u=Ext.clone(u),w=y.rows[0],t=u.idValueMap,z=y.sorting?y.sorting.direction:"DESC",x;w.ids=[];for(var v=0,C,B,A;v<w.items.length;v++){C=w.items[v];B=s+C.id;A=parseFloat(t[B]);C.value=Ext.isNumber(A)?A:(Number.MAX_VALUE*-1)}o.prototype.array.sort(w.items,z,"value");for(var v=0;v<w.items.length;v++){w.ids.push(w.items[v].id)}x=p.layout.Layout(y);n.pivot.createTable(x,null,u,false)}};h=function(){return{centerRegion:Ext.get(j.el)}};g=function(){if(!l(j)){return}k.core=PT.getCore(Ext.clone(e));i(k);k.app.viewport=h();k.app.centerRegion=k.app.viewport.centerRegion;if(j.id){k.core.web.pivot.loadTable(j.id)}else{layout=k.core.api.layout.Layout(j);if(!layout){return}k.core.web.pivot.getData(layout)}}()};PT.plugin.getTable=function(g){if(Ext.isString(g.url)&&g.url.split("").pop()==="/"){g.url=g.url.substr(0,g.url.length-1)}if(b){c(g)}else{d.push(g);if(!f){f=true;a(g.url)}}};DHIS=Ext.isObject(window.DHIS)?DHIS:{};DHIS.getTable=PT.plugin.getTable});
